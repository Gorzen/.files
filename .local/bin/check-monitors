#!/bin/zsh

# Refresh xrandr
xrandr --output eDP1 --primary --auto
~/.fehbg

# Kill imwheel if it were running
#pkill imwheel

if [ "$(xrandr | grep "^DP1 connected")" ]; then
  # Multiple monitors
  fontscale="1.2"
  patch="$HOME/.config/fontconfig/bigger-fonts.diff"

  # Dual monitor
	xrandr --output DP1 --right-of eDP1 --primary --auto
	~/.fehbg

  # Mouse natural scrolling
  xinput --set-prop "Logitech Gaming Mouse G502" "libinput Natural Scrolling Enabled" 0

  # Disable lock screen
  xset s off
  xset dpms 0 0 0

  # Increase scroll step
  #imwheel
else
  # Single monitor
  fontscale="1.0"
  patch="$HOME/.config/fontconfig/normal-fonts.diff"

  # Enable lock screen
  xset s 300 15
  xset dpms 600 600 600
fi

# Write font scale
printf "%s" "$fontscale" > $HOME/.fontscale

# Scale fonts
cd /
patch -p0 --follow-symlinks -N < "$patch"

# Change tray_output i3
#sed -i --follow-symlinks 's/tray_output\(\s\+\)\w*$/tray_output\1'"$tray"'/g' $HOME/.config/i3/actual_config $HOME/.config/i3/config

if [ "$1" = "firefox" ]; then
  # Scale Firefox UI
  pkill firefox
  sed -i 's/user_pref("layout.css.devPixelsPerPx", "[0-9].[0-9]");/user_pref("layout.css.devPixelsPerPx", "'"$fontscale"'");/g' $HOME/.mozilla/firefox/td0a8llh.default-release/prefs.js
fi

# Restart i3
restart-i3
